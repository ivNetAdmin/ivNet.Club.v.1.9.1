var Availability = angular.module('ivNet.Availability', ['ngResource'])

Availability.factory('availability', function ($resource) {
    return $resource('/api/club/availability/:id', null,
    {
        'query': { method: 'Get', isArray: false },
        'update': { method: 'PUT' }
    });
});

Availability.controller('AvailabilityController', function ($scope, availability) {

    $scope.toggleAvailability = function () {
        var available = false;
        if (this.day.Date.length > 0) {
            if ($('td#' + this.month.Name + this.day.Date).hasClass('available-false')) {
                $('td#' + this.month.Name + this.day.Date).removeClass('available-false').addClass('available-true');
                available = true;
            } else {
                $('td#' + this.month.Name + this.day.Date).removeClass('available-true').addClass('available-false');
            }

            var data = {
                Available: available,
                Month: this.month.Name,
                Date: this.day.Date
            };
            $('#loading-indicator').show();
            availability.update({ id: $scope.playerId }, data,
                function() {
                    $('#loading-indicator').hide();
                },
                function (error) {
                    $('#loading-indicator').hide();
                    alert(error.data.Message + ' [' + error.data.MessageDetail + ']');
                });
        }
    };

    init();

    function init() {
        $('#loading-indicator').show();
        availability.query({ },
           function (data) {
               $('#loading-indicator').hide();
               $scope.months = data.Months;
               $scope.playerId = data.PlayerId;
           },
            function (error) {
                $('#loading-indicator').hide();
                alert(error.data.Message + ' [' + error.data.MessageDetail + ']');
            });
    };
});